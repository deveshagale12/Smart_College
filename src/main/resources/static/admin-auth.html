<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal | Smart College</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #1a1c23; /* Darker professional theme */
            height: 100vh;
            display: flex; align-items: center; justify-content: center;
        }
        .admin-card {
            background: white; border-radius: 12px;
            width: 100%; max-width: 450px; padding: 40px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        .btn-admin { background: #4f46e5; color: white; border: none; }
        .btn-admin:hover { background: #4338ca; color: white; }
        .hidden { display: none; }
        
        /* Back button styling */
        .back-link {
            text-decoration: none;
            color: #9ca3af;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            margin-bottom: 1.5rem;
            transition: color 0.2s;
        }
        .back-link:hover {
            color: #4f46e5;
        }
    </style>
</head>
<body>

    <div class="admin-card">
        <a href="home.html" class="back-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left me-2" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
            </svg>
            Back to Home
        </a>

        <div class="text-center mb-4">
            <h2 id="title" class="fw-bold text-dark">Admin Login</h2>
            <p id="subtitle" class="text-muted">Access the master control panel</p>
        </div>

        <form id="login-form" onsubmit="handleAdminAuth(event, 'login')">
            <div class="mb-3">
                <label class="form-label small fw-bold">Email Address</label>
                <input type="email" id="login-email" class="form-control" required placeholder="admin@college.edu">
            </div>
            <div class="mb-3">
                <label class="form-label small fw-bold">Password</label>
                <input type="password" id="login-pass" class="form-control" required placeholder="••••••••">
            </div>
            <button type="submit" class="btn btn-admin w-100 py-2 fw-bold">Enter Dashboard</button>
            <p class="text-center mt-3 small">New Admin? <a href="#" onclick="toggleForms()">Register here</a></p>
        </form>

        <form id="reg-form" class="hidden" onsubmit="handleAdminAuth(event, 'register')">
            <div class="mb-3">
                <label class="form-label small fw-bold">Full Name</label>
                <input type="text" id="reg-name" class="form-control" required>
            </div>
            <div class="mb-3">
                <label class="form-label small fw-bold">Post/Designation</label>
                <input type="text" id="reg-post" class="form-control" placeholder="e.g. Dean, HOD" required>
            </div>
            <div class="mb-3">
                <label class="form-label small fw-bold">Email</label>
                <input type="email" id="reg-email" class="form-control" required>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label small fw-bold">Mobile</label>
                    <input type="text" id="reg-mobile" class="form-control" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label small fw-bold">Password</label>
                    <input type="password" id="reg-pass" class="form-control" required>
                </div>
            </div>
            <button type="submit" class="btn btn-success w-100 py-2 fw-bold">Create Admin Account</button>
            <p class="text-center mt-3 small">Have an account? <a href="#" onclick="toggleForms()">Login</a></p>
        </form>
    </div>

    <script>
       function toggleForms() {
            document.getElementById('login-form').classList.toggle('hidden');
            document.getElementById('reg-form').classList.toggle('hidden');
            const isLogin = !document.getElementById('login-form').classList.contains('hidden');
            document.getElementById('title').innerText = isLogin ? "Admin Login" : "Admin Registration";
        }
        async function handleAdminAuth(event, type) {
            event.preventDefault();
            const url = type === 'login' ? 'https://smart-college.onrender.com/api/admin/login' : 'https://smart-college.onrender.com/api/admin/register';
            
            let payload = {};
            if(type === 'login') {
                payload = {
                    email: document.getElementById('login-email').value,
                    password: document.getElementById('login-pass').value
                };
            } else {
                payload = {
                    adminName: document.getElementById('reg-name').value,
                    post: document.getElementById('reg-post').value,
                    email: document.getElementById('reg-email').value,
                    mobileNumber: document.getElementById('reg-mobile').value,
                    password: document.getElementById('reg-pass').value
                };
            }

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    const admin = await response.json();
                    // Save Admin Session
                    localStorage.setItem('adminId', admin.id);
                    localStorage.setItem('adminName', admin.adminName);
                    localStorage.setItem('role', 'ADMIN');
                    
                    alert(type === 'login' ? "Access Granted!" : "Admin Registered!");
                    window.location.href = "admindashboard.html";
                } else {
                    const error = await response.text();
                    alert("Auth Failed: " + error);
                }
            } catch (err) {
                alert("Server Connection Error");
            }
        }
    </script>
</body>
</html>